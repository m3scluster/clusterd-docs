<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Framework Development Guide describes how to build applications on top of Mesos. - Apache Mesos</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Fundamentals</li><li class="chapter-item expanded "><a href="architecture.html"><strong aria-hidden="true">1.</strong> Mesos Architecture providing an overview of Mesos concepts</a></li><li class="chapter-item expanded "><a href="presentations.html"><strong aria-hidden="true">2.</strong> Video and Slides of Mesos Presentations</a></li><li class="chapter-item expanded "><a href="versioning.html"><strong aria-hidden="true">3.</strong> Mesos Release and Support Policy</a></li><li class="chapter-item expanded affix "><li class="part-title">Build / Installation</li><li class="chapter-item expanded "><a href="building.html"><strong aria-hidden="true">4.</strong> Building for basic instructions on compiling and installing Mesos.</a></li><li class="chapter-item expanded "><a href="binary-packages.html"><strong aria-hidden="true">5.</strong> Binary Packages for how to use Mesos binary packages.</a></li><li class="chapter-item expanded "><a href="configuration.html"><strong aria-hidden="true">6.</strong> Configuration for build configuration options.</a></li><li class="chapter-item expanded "><a href="cmake.html"><strong aria-hidden="true">7.</strong> CMake for details about using the new CMake build system.</a></li><li class="chapter-item expanded "><a href="windows.html"><strong aria-hidden="true">8.</strong> Windows Support for the state of Windows support in Mesos.</a></li><li class="chapter-item expanded affix "><li class="part-title">Administration</li><li class="chapter-item expanded "><a href="configuration.html"><strong aria-hidden="true">9.</strong> Configuration for command-line arguments.</a></li><li class="chapter-item expanded "><a href="high-availability.html"><strong aria-hidden="true">10.</strong> High Availability Master Setup</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="replicated-log-internals.html"><strong aria-hidden="true">10.1.</strong> Replicated Log for information on the Mesos replicated log.</a></li></ol></li><li class="chapter-item expanded "><a href="agent-recovery.html"><strong aria-hidden="true">11.</strong> Fault Tolerant Agent Setup</a></li><li class="chapter-item expanded "><a href="framework-rate-limiting.html"><strong aria-hidden="true">12.</strong> Framework Rate Limiting</a></li><li class="chapter-item expanded "><a href="maintenance.html"><strong aria-hidden="true">13.</strong> Maintenance for performing maintenance on a Mesos cluster.</a></li><li class="chapter-item expanded "><a href="upgrades.html"><strong aria-hidden="true">14.</strong> Upgrades for upgrading a Mesos cluster.</a></li><li class="chapter-item expanded "><a href="downgrades.html"><strong aria-hidden="true">15.</strong> Downgrades for downgrading a Mesos cluster.</a></li><li class="chapter-item expanded "><a href="logging.html"><strong aria-hidden="true">16.</strong> Logging</a></li><li class="chapter-item expanded "><a href="monitoring.html"><strong aria-hidden="true">17.</strong> Monitoring / Metrics</a></li><li class="chapter-item expanded "><a href="cli.html"><strong aria-hidden="true">18.</strong> Debugging using the new CLI</a></li><li class="chapter-item expanded "><a href="operational-guide.html"><strong aria-hidden="true">19.</strong> Operational Guide</a></li><li class="chapter-item expanded "><a href="fetcher.html"><strong aria-hidden="true">20.</strong> Fetcher Cache Configuration</a></li><li class="chapter-item expanded "><a href="fault-domains.html"><strong aria-hidden="true">21.</strong> Fault Domains</a></li><li class="chapter-item expanded "><a href="performance-profiling.html"><strong aria-hidden="true">22.</strong> Performance Profiling for debugging performance issues in Mesos.</a></li><li class="chapter-item expanded "><a href="memory-profiling.html"><strong aria-hidden="true">23.</strong> Memory Profiling for debugging potential memory leaks in Mesos.</a></li><li class="chapter-item expanded affix "><li class="part-title">Resource Management</li><li class="chapter-item expanded "><a href="attributes-resources.html"><strong aria-hidden="true">24.</strong> Attributes and Resources for how to describe the agents that comprise a cluster.</a></li><li class="chapter-item expanded "><a href="roles.html"><strong aria-hidden="true">25.</strong> Using Resource Roles</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="weights.html"><strong aria-hidden="true">25.1.</strong> Resource Role Weights for fair sharing.</a></li><li class="chapter-item expanded "><a href="quota.html"><strong aria-hidden="true">25.2.</strong> Resource Role Quota for how to configure Mesos to provide guaranteed resource allocations for use by a role.</a></li><li class="chapter-item expanded "><a href="reservation.html"><strong aria-hidden="true">25.3.</strong> Reservations for how operators and frameworks can reserve resources on individual agents for use by a role.</a></li><li class="chapter-item expanded "><a href="shared-resources.html"><strong aria-hidden="true">25.4.</strong> Shared Resources for how to share persistent volumes between tasks managed by different executors on the same agent.</a></li></ol></li><li class="chapter-item expanded "><a href="oversubscription.html"><strong aria-hidden="true">26.</strong> Oversubscription for how to configure Mesos to take advantage of unused resources to launch “best-effort” tasks.</a></li><li class="chapter-item expanded affix "><li class="part-title">Security</li><li class="chapter-item expanded "><a href="authentication.html"><strong aria-hidden="true">27.</strong> Authentication</a></li><li class="chapter-item expanded "><a href="authorization.html"><strong aria-hidden="true">28.</strong> Authorization</a></li><li class="chapter-item expanded "><a href="ssl.html"><strong aria-hidden="true">29.</strong> SSL</a></li><li class="chapter-item expanded "><a href="secrets.html"><strong aria-hidden="true">30.</strong> Secrets for managing secrets within Mesos.</a></li><li class="chapter-item expanded affix "><li class="part-title">Containerization</li><li class="chapter-item expanded "><a href="containerizers.html"><strong aria-hidden="true">31.</strong> Containerizer Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="containerizer-internals.html"><strong aria-hidden="true">31.1.</strong> Containerizer Internals for implementation details of containerizers.</a></li><li class="chapter-item expanded "><a href="docker-containerizer.html"><strong aria-hidden="true">31.2.</strong> Docker Containerizer for launching a Docker image as a Task, or as an Executor.</a></li><li class="chapter-item expanded "><a href="mesos-containerizer.html"><strong aria-hidden="true">31.3.</strong> Mesos Containerizer default containerizer, supports both Linux and POSIX systems.</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="container-image.html"><strong aria-hidden="true">31.3.1.</strong> Container Images for supporting container images in Mesos containerizer.</a></li><li class="chapter-item expanded "><a href="isolators/docker-volume.html"><strong aria-hidden="true">31.3.2.</strong> Docker Volume Support</a></li><li class="chapter-item expanded "><a href="gpu-support.html"><strong aria-hidden="true">31.3.3.</strong> Nvidia GPU Support for how to run Mesos with Nvidia GPU support.</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="sandbox.html"><strong aria-hidden="true">32.</strong> Container Sandboxes</a></li><li class="chapter-item expanded "><a href="container-volume.html"><strong aria-hidden="true">33.</strong> Container Volumes</a></li><li class="chapter-item expanded "><a href="nested-container-and-task-group.html"><strong aria-hidden="true">34.</strong> Nested Container and Task Group (Pod)</a></li><li class="chapter-item expanded "><a href="standalone-containers.html"><strong aria-hidden="true">35.</strong> Standalone Containers</a></li><li class="chapter-item expanded affix "><li class="part-title">Networking</li><li class="chapter-item expanded "><a href="networking.html"><strong aria-hidden="true">36.</strong> Networking Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="networking-for-mesos-managed-containers.html"><strong aria-hidden="true">36.1.</strong> Networking in Detail</a></li><li class="chapter-item expanded "><a href="cni.html"><strong aria-hidden="true">36.2.</strong> Container Network Interface (CNI)</a></li><li class="chapter-item expanded "><a href="isolators/network-port-mapping.html"><strong aria-hidden="true">36.3.</strong> Port Mapping Isolator</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Storage</li><li class="chapter-item expanded "><a href="multiple-disk.html"><strong aria-hidden="true">37.</strong> Multiple Disks for how to allow tasks to use multiple isolated disk resources.</a></li><li class="chapter-item expanded "><a href="persistent-volume.html"><strong aria-hidden="true">38.</strong> Persistent Volume for how to allow tasks to access persistent storage resources.</a></li><li class="chapter-item expanded "><a href="csi.html"><strong aria-hidden="true">39.</strong> Container Storage Interface (CSI) Support</a></li><li class="chapter-item expanded affix "><li class="part-title">Scheduler and Executor Development</li><li class="chapter-item expanded "><a href="running-workloads.html"><strong aria-hidden="true">40.</strong> Running Workloads in Mesos explains how a scheduler can specify and run tasks.</a></li><li class="chapter-item expanded "><a href="app-framework-development-guide.html" class="active"><strong aria-hidden="true">41.</strong> Framework Development Guide describes how to build applications on top of Mesos.</a></li><li class="chapter-item expanded "><a href="high-availability-framework-guide.html"><strong aria-hidden="true">42.</strong> Guide for Designing Highly Available Mesos Frameworks</a></li><li class="chapter-item expanded "><a href="reconciliation.html"><strong aria-hidden="true">43.</strong> Reconciliation for ensuring a framework’s state remains eventually consistent in the face of failures.</a></li><li class="chapter-item expanded "><a href="task-state-reasons.html"><strong aria-hidden="true">44.</strong> Task State Reasons describes how task state reasons are used in Mesos.</a></li><li class="chapter-item expanded "><a href="health-checks.html"><strong aria-hidden="true">45.</strong> Task Health Checking</a></li><li class="chapter-item expanded "><a href="scheduler-http-api.html"><strong aria-hidden="true">46.</strong> v1 Scheduler HTTP API for communication between schedulers and the Mesos master.</a></li><li class="chapter-item expanded "><a href="executor-http-api.html"><strong aria-hidden="true">47.</strong> v1 Executor HTTP API describes the new HTTP API for communication between executors and the Mesos agent.</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Apache Mesos</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/AVENTER-UG/mesos-docs/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <hr />
<h2>title: Apache Mesos - Framework Development Guide
layout: documentation</h2>
<h1 id="framework-development-guide"><a class="header" href="#framework-development-guide">Framework Development Guide</a></h1>
<p>In this document we refer to Mesos applications as &quot;frameworks&quot;.</p>
<p>See one of the example framework schedulers in <code>MESOS_HOME/src/examples/</code> to
get an idea of what a Mesos framework scheduler and executor in the language
of your choice looks like. <a href="https://github.com/mesosphere/RENDLER">RENDLER</a>
provides example framework implementations in C++, Go, Haskell, Java, Python
and Scala.</p>
<h2 id="create-your-framework-scheduler"><a class="header" href="#create-your-framework-scheduler">Create your Framework Scheduler</a></h2>
<h3 id="api"><a class="header" href="#api">API</a></h3>
<p>If you are writing a scheduler against Mesos 1.0 or newer, it is recommended
to use the new <a href="scheduler-http-api.html">HTTP API</a> to talk to Mesos.</p>
<p>If your framework needs to talk to Mesos 0.28.0 or older, or you have not updated to the
<a href="scheduler-http-api.html">HTTP API</a>, you can write the scheduler in C++, Java/Scala, or Python.
Your framework scheduler should inherit from the <code>Scheduler</code> class
(see: <a href="https://github.com/apache/mesos/blob/1.6.0/include/mesos/scheduler.hpp#L58-L177">C++</a>,
<a href="http://mesos.apache.org/api/latest/java/org/apache/mesos/Scheduler.html">Java</a>,
<a href="https://github.com/apache/mesos/blob/1.6.0/src/python/interface/src/mesos/interface/__init__.py#L34-L137">Python</a>). Your scheduler should create a SchedulerDriver (which will mediate
communication between your scheduler and the Mesos master) and then call <code>SchedulerDriver.run()</code>
(see: <a href="https://github.com/apache/mesos/blob/1.6.0/include/mesos/scheduler.hpp#L180-L317">C++</a>,
<a href="http://mesos.apache.org/api/latest/java/org/apache/mesos/SchedulerDriver.html">Java</a>,
<a href="https://github.com/apache/mesos/blob/1.6.0/src/python/interface/src/mesos/interface/__init__.py#L140-L278">Python</a>).</p>
<h3 id="high-availability"><a class="header" href="#high-availability">High Availability</a></h3>
<p>How to build Mesos frameworks that are highly available in the face of failures is
discussed in a <a href="high-availability-framework-guide.html">separate document</a>.</p>
<h3 id="multi-scheduler-scalability"><a class="header" href="#multi-scheduler-scalability">Multi-Scheduler Scalability</a></h3>
<p>When implementing a scheduler, it's important to adhere to the following guidelines
in order to ensure that the scheduler can run in a scalable manner alongside other
schedulers in the same Mesos cluster:</p>
<ol>
<li><strong>Use <code>Suppress</code></strong>: The scheduler must stay in a suppressed state whenever it has
no additional tasks to launch or offer operations to perform. This ensures
that Mesos can more efficiently offer resources to those frameworks that do
have work to perform.</li>
<li><strong>Do not hold onto offers</strong>: If an offer cannot be used, decline it immediately.
Otherwise the resources cannot be offered to other schedulers and the scheduler
itself will receive fewer additional offers.</li>
<li><strong><code>Decline</code> resources using a large timeout</strong>: when declining an offer, use a
large <code>Filters.refuse_seconds</code> timeout (e.g. 1 hour). This ensures that Mesos
will have time to try offering the resources to other scheduler before trying
the same scheduler again. However, if the scheduler is unable to eventually
enter a <code>SUPPRESS</code>ed state, and it has new workloads to run after having declined,
it should consider <code>REVIVE</code>ing if it is not receiving sufficient resources for
some time.</li>
<li><strong>Do not <code>REVIVE</code> frequently</strong>: <code>REVIVE</code>ing clears all filters, and therefore
if <code>REVIVE</code> occurs frequently it is similar to always declining with a very
short timeout (violation of guideline (3)).</li>
<li><strong>Use <code>FrameworkInfo.offer_filters</code></strong>: This allows the scheduler to specify
global offer filters (<code>Decline</code> filters, on the other hand, are per-agent).
Currently supported is <code>OfferFilters.min_allocatable_resources</code> which acts as
an override of the cluster level <code>--min_allocatable_resources</code> master flag for
each of the scheduler's roles. Keeping the <code>FrameworkInfo.offer_filters</code>
up-to-date with the minimum desired offer shape for each role will ensure that
the sccheduler gets a better chance to receive offers sized with sufficient
resources.</li>
<li>Consider specifying <strong>offer constraints</strong> via <code>SUBSCRIBE</code>/<code>UPDATE_FRAMEWORK</code>
calls so that the framework role's quota is not consumed by offers that the
scheduler will have to decline anyway based on agent attributes.
See <a href="https://issues.apache.org/jira/browse/MESOS-10161%5D">MESOS-10161</a>
and <a href="https://github.com/apache/mesos/blob/master/include/mesos/v1/scheduler/scheduler.proto">scheduler.proto</a>
for more details.</li>
</ol>
<p>Operationally, the following can be done to ensure that schedulers get the resources
they need when co-existing with other schedulers:</p>
<ol>
<li><strong>Do not share a role between schedulers</strong>: Roles are the level at which controls
are available (e.g. quota, weight, reservation) that affect resource allocation.
Within a role, there are no controls to alter the behavior should one scheduler
not receive enough resources.</li>
<li><strong>Set quota if roles need a guarantee</strong>: If a role (either an entire scheduler or
a &quot;job&quot;/&quot;service&quot;/etc within a multi-tenant scheduler) needs a certain amount of
resources guaranteed to it, setting a quota ensures that Mesos will try its best
to allocate to satisfy the guarantee.</li>
<li><strong>Set the minimum allocatable resources</strong>: Once quota is used, the
<code>--min_allocatable_resources</code> flag should be set
(e.g. <code>--min_allocatable_resources=cpus:0.1,mem:32:disk:32</code>) to prevent offers
that are missing cpu, memory, or disk
(see <a href="https://issues.apache.org/jira/browse/MESOS-8935">MESOS-8935</a>).</li>
<li><strong>Consider enabling the random sorter</strong>: Depending on the use case, DRF can prove
problematic in that it will try to allocate to frameworks with a low share of the
cluster and penalize frameworks with a high share of the cluster. This can lead
to offer starvation for higher share frameworks. To allocate using a weighted
random uniform distribution instead of fair sharing, set <code>--role_sorter=random</code>
and <code>--framework_sorter=random</code> (see
<a href="https://issues.apache.org/jira/browse/MESOS-8936">MESOS-8936</a>).</li>
</ol>
<p>See the <a href="https://docs.google.com/document/d/1uvTmBo_21Ul9U_mijgWyh7hE0E_yZXrFr43JIB9OCl8">Offer Starvation Design Document</a>
in <a href="https://issues.apache.org/jira/browse/MESOS-3202">MESOS-3202</a> for more
information about the pitfalls and future plans for running multiple schedulers.</p>
<h2 id="working-with-executors"><a class="header" href="#working-with-executors">Working with Executors</a></h2>
<h3 id="using-the-mesos-command-executor"><a class="header" href="#using-the-mesos-command-executor">Using the Mesos Command Executor</a></h3>
<p>Mesos provides a simple executor that can execute shell commands and Docker
containers on behalf of the framework scheduler; enough functionality for a
wide variety of framework requirements.</p>
<p>Any scheduler can make use of the Mesos command executor by filling in the
optional <code>CommandInfo</code> member of the <code>TaskInfo</code> protobuf message.</p>
<pre><code class="language-{.proto}">message TaskInfo {
  ...
  optional CommandInfo command = 7;
  ...
}
</code></pre>
<p>The Mesos slave will fill in the rest of the <code>ExecutorInfo</code> for you when tasks
are specified this way.</p>
<p>Note that the agent will derive an <code>ExecutorInfo</code> from the <code>TaskInfo</code> and
additionally copy fields (e.g., <code>Labels</code>) from <code>TaskInfo</code> into the new
<code>ExecutorInfo</code>. This <code>ExecutorInfo</code> is only visible on the agent.</p>
<h3 id="using-the-mesos-default-executor"><a class="header" href="#using-the-mesos-default-executor">Using the Mesos Default Executor</a></h3>
<p>Since Mesos 1.1, a new built-in default executor (<strong>experimental</strong>) is available that
can execute a group of tasks. Just like the command executor the tasks can be shell
commands or Docker containers.</p>
<p>The current semantics of the default executor are as folows:</p>
<p>-- Task group is an atomic unit of deployment of a scheduler onto the default executor.</p>
<p>-- The default executor can run one or more task groups (since Mesos 1.2) and each task group can be launched by the scheduler at different points in time.</p>
<p>-- All task groups' tasks are launched as nested containers underneath the executor container.</p>
<p>-- Task containers and executor container share resources like cpu, memory,
network and volumes.</p>
<p>-- Each task can have its own separate root file system (e.g., Docker image).</p>
<p>-- There is no resource isolation between different tasks or task groups within an executor.
Tasks' resources are added to the executor container.</p>
<p>-- If any of the tasks exits with a non-zero exit code or killed by the scheduler, all the tasks in the task group
are killed automatically. The default executor commits suicide if there are no active task groups.</p>
<p>Once the default executor is considered <strong>stable</strong>, the command executor will be deprecated in favor of it.</p>
<p>Any scheduler can make use of the Mesos default executor by setting <code>ExecutorInfo.type</code>
to <code>DEFAULT</code> when launching a group of tasks using the <code>LAUNCH_GROUP</code> offer operation.
If <code>DEFAULT</code> executor is explicitly specified when using <code>LAUNCH</code> offer operation, command
executor is used instead of the default executor. This might change in the future when the default
executor gets support for handling <code>LAUNCH</code> operation.</p>
<pre><code class="language-{.proto}">message ExecutorInfo {
  ...
    optional Type type = 15;
  ...
}
</code></pre>
<h3 id="creating-a-custom-framework-executor"><a class="header" href="#creating-a-custom-framework-executor">Creating a custom Framework Executor</a></h3>
<p>If your framework has special requirements, you might want to provide your own
Executor implementation. For example, you may not want a 1:1 relationship
between tasks and processes.</p>
<p>If you are writing an executor against Mesos 1.0 or newer, it is recommended
to use the new <a href="executor-http-api.html">HTTP API</a> to talk to Mesos.</p>
<p>If writing against Mesos 0.28.0 or older, your framework executor must inherit
from the Executor class (see (see: <a href="https://github.com/apache/mesos/blob/1.6.0/include/mesos/executor.hpp#L60-L137">C++</a>,
<a href="http://mesos.apache.org/api/latest/java/org/apache/mesos/Executor.html">Java</a>,
<a href="https://github.com/apache/mesos/blob/1.6.0/src/python/interface/src/mesos/interface/__init__.py#L280-L344">Python</a>). It must override the launchTask() method. You can use
the $MESOS_HOME environment variable inside of your executor to determine where
Mesos is running from. Your executor should create an ExecutorDriver (which will
mediate communication between your executor and the Mesos agent) and then call
<code>ExecutorDriver.run()</code>
(see: <a href="https://github.com/apache/mesos/blob/1.6.0/include/mesos/executor.hpp#L140-L188">C++</a>,
<a href="http://mesos.apache.org/api/latest/java/org/apache/mesos/ExecutorDriver.html">Java</a>,
<a href="https://github.com/apache/mesos/blob/1.6.0/src/python/interface/src/mesos/interface/__init__.py#L348-L401">Python</a>).</p>
<h4 id="install-your-custom-framework-executor"><a class="header" href="#install-your-custom-framework-executor">Install your custom Framework Executor</a></h4>
<p>After creating your custom executor, you need to make it available to all slaves
in the cluster.</p>
<p>One way to distribute your framework executor is to let the
<a href="fetcher.html">Mesos fetcher</a> download it on-demand when your scheduler launches
tasks on that slave. <code>ExecutorInfo</code> is a Protocol Buffer Message class (defined
in <code>include/mesos/mesos.proto</code>), and it contains a field of type <code>CommandInfo</code>.
<code>CommandInfo</code> allows schedulers to specify, among other things, a number of
resources as URIs. These resources are fetched to a sandbox directory on the
slave before attempting to execute the <code>ExecutorInfo</code> command. Several URI
schemes are supported, including HTTP, FTP, HDFS, and S3 (e.g. see
src/examples/java/TestFramework.java for an example of this).</p>
<p>Alternatively, you can pass the <code>frameworks_home</code> configuration option
(defaults to: <code>MESOS_HOME/frameworks</code>) to your <code>mesos-slave</code> daemons when you
launch them to specify where your framework executors are stored (e.g. on an
NFS mount that is available to all slaves), then use a relative path in
<code>CommandInfo.uris</code>, and the slave will prepend the value of <code>frameworks_home</code>
to the relative path provided.</p>
<p>Once you are sure that your executors are available to the mesos-slaves, you
should be able to run your scheduler, which will register with the Mesos master,
and start receiving resource offers!</p>
<h2 id="labels"><a class="header" href="#labels">Labels</a></h2>
<p><code>Labels</code> can be found in the <code>FrameworkInfo</code>, <code>TaskInfo</code>, <code>DiscoveryInfo</code> and
<code>TaskStatus</code> messages; framework and module writers can use Labels to tag and
pass unstructured information around Mesos. Labels are free-form key-value pairs
supplied by the framework scheduler or label decorator hooks. Below is the
protobuf definitions of labels:</p>
<pre><code class="language-{.proto}">  optional Labels labels = 11;
</code></pre>
<pre><code class="language-{.proto}">/**
 * Collection of labels.
 */
message Labels {
    repeated Label labels = 1;
}

/**
 * Key, value pair used to store free form user-data.
 */
message Label {
  required string key = 1;
  optional string value = 2;
}
</code></pre>
<p>Labels are not interpreted by Mesos itself, but will be made available over
master and slave state endpoints. Further more, the executor and scheduler can
introspect labels on the <code>TaskInfo</code> and <code>TaskStatus</code> programmatically.
Below is an example of how two label pairs (<code>&quot;environment&quot;: &quot;prod&quot;</code> and
<code>&quot;bananas&quot;: &quot;apples&quot;</code>) can be fetched from the master state endpoint.</p>
<pre><code class="language-{.sh}">$ curl http://master/state.json
...
{
  &quot;executor_id&quot;: &quot;default&quot;,
  &quot;framework_id&quot;: &quot;20150312-120017-16777343-5050-39028-0000&quot;,
  &quot;id&quot;: &quot;3&quot;,
  &quot;labels&quot;: [
    {
      &quot;key&quot;: &quot;environment&quot;,
      &quot;value&quot;: &quot;prod&quot;
    },
    {
      &quot;key&quot;: &quot;bananas&quot;,
      &quot;value&quot;: &quot;apples&quot;
    }
  ],
  &quot;name&quot;: &quot;Task 3&quot;,
  &quot;slave_id&quot;: &quot;20150312-115625-16777343-5050-38751-S0&quot;,
  &quot;state&quot;: &quot;TASK_FINISHED&quot;,
  ...
},
</code></pre>
<h2 id="service-discovery"><a class="header" href="#service-discovery">Service discovery</a></h2>
<p>When your framework registers an executor or launches a task, it can provide
additional information for service discovery. This information is stored by
the Mesos master along with other imporant information such as the slave
currently running the task. A service discovery system can programmatically
retrieve this information in order to set up DNS entries, configure proxies,
or update any consistent store used for service discovery in a Mesos cluster
that runs multiple frameworks and multiple tasks.</p>
<p>The optional <code>DiscoveryInfo</code> message for <code>TaskInfo</code> and <code>ExecutorInfo</code> is
declared in  <code>MESOS_HOME/include/mesos/mesos.proto</code></p>
<pre><code class="language-{.proto}">message DiscoveryInfo {
  enum Visibility {
    FRAMEWORK = 0;
    CLUSTER = 1;
    EXTERNAL = 2;
  }

  required Visibility visibility = 1;
  optional string name = 2;
  optional string environment = 3;
  optional string location = 4;
  optional string version = 5;
  optional Ports ports = 6;
  optional Labels labels = 7;
}
</code></pre>
<p><code>Visibility</code> is the key parameter that instructs the service discovery system
whether a service should be discoverable. We currently differentiate between
three cases:</p>
<ul>
<li>a task should not be discoverable for anyone but its framework.</li>
<li>a task should be discoverable for all frameworks running on the Mesos cluster
but not externally.</li>
<li>a task should be made discoverable broadly.</li>
</ul>
<p>Many service discovery systems provide additional features that manage the
visibility of services (e.g., ACLs in proxy based systems, security extensions
to DNS, VLAN or subnet selection). It is not the intended use of the visibility
field to manage such features. When a service discovery system retrieves the
task or executor information from the master, it can decide how to handle tasks
without <code>DiscoveryInfo</code>. For instance, tasks may be made non discoverable to
other frameworks (equivalent to <code>visibility=FRAMEWORK</code>) or discoverable to all
frameworks (equivalent to <code>visibility=CLUSTER</code>).</p>
<p>The <code>name</code> field is a string that provides the service discovery system
with the name under which the task is discoverable. The typical use of the name
field will be to provide a valid hostname. If name is not provided, it is up to
the service discovery system to create a name for the task based on the name
field in <code>taskInfo</code> or other information.</p>
<p>The <code>environment</code>, <code>location</code>, and <code>version</code> fields provide first class support
for common attributes used to differentiate between similar services in large
deployments. The <code>environment</code> may receive values such as <code>PROD/QA/DEV</code>, the
<code>location</code> field may receive values like <code>EAST-US/WEST-US/EUROPE/AMEA</code>, and the
<code>version</code> field may receive values like v2.0/v0.9. The exact use of these fields
is up to the service discovery system.</p>
<p>The <code>ports</code> field allows the framework to identify the ports a task listens to
and explicitly name the functionality they represent and the layer-4 protocol
they use (TCP, UDP, or other). For example, a Cassandra task will define ports
like <code>&quot;7000,Cluster,TCP&quot;</code>, <code>&quot;7001,SSL,TCP&quot;</code>, <code>&quot;9160,Thrift,TCP&quot;</code>,
<code>&quot;9042,Native,TCP&quot;</code>, and <code>&quot;7199,JMX,TCP&quot;</code>. It is up to the service discovery
system to use these names and protocol in appropriate ways, potentially
combining them with the <code>name</code> field in <code>DiscoveryInfo</code>.</p>
<p>The <code>labels</code> field allows a framework to pass arbitrary labels to the service
discovery system in the form of key/value pairs. Note that anything passed
through this field is not guaranteed to be supported moving forward.
Nevertheless, this field provides extensibility. Common uses of this field will
allow us to identify use cases that require first class support.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="running-workloads.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="high-availability-framework-guide.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="running-workloads.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="high-availability-framework-guide.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
